<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 450">
  <defs>
    <linearGradient id="packetGrad1" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="packetGrad2" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#d97706;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="packetGrad3" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <marker id="arrowDown" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#6b7280"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="700" height="450" fill="#0f172a"/>

  <!-- Title -->
  <text x="350" y="35" text-anchor="middle" fill="#f8fafc" font-family="Inter, system-ui, sans-serif" font-size="20" font-weight="600">Packet Transformation (NAT)</text>

  <!-- Original Packet Box -->
  <rect x="50" y="60" width="600" height="80" rx="8" fill="url(#packetGrad1)" filter="url(#shadow)"/>
  <text x="350" y="85" text-anchor="middle" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="600">ORIGINAL PACKET (arriving on wg0)</text>

  <!-- Original Packet Details -->
  <rect x="80" y="100" width="250" height="30" rx="4" fill="#1e3a8a"/>
  <text x="205" y="120" text-anchor="middle" fill="#93c5fd" font-family="monospace" font-size="12">src: 10.50.3.10</text>

  <rect x="370" y="100" width="250" height="30" rx="4" fill="#1e3a8a"/>
  <text x="495" y="120" text-anchor="middle" fill="#93c5fd" font-family="monospace" font-size="12">dst: 10.50.0.1:5432</text>

  <!-- Arrow 1 -->
  <line x1="350" y1="145" x2="350" y2="175" stroke="#6b7280" stroke-width="2" marker-end="url(#arrowDown)"/>
  <rect x="240" y="155" width="220" height="24" rx="4" fill="#1e293b"/>
  <text x="350" y="172" text-anchor="middle" fill="#fbbf24" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="500">PREROUTING (DNAT)</text>

  <!-- After DNAT Box -->
  <rect x="50" y="185" width="600" height="80" rx="8" fill="url(#packetGrad2)" filter="url(#shadow)"/>
  <text x="350" y="210" text-anchor="middle" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="600">AFTER DNAT</text>

  <!-- After DNAT Details -->
  <rect x="80" y="225" width="250" height="30" rx="4" fill="#78350f"/>
  <text x="205" y="245" text-anchor="middle" fill="#fcd34d" font-family="monospace" font-size="12">src: 10.50.3.10</text>

  <rect x="370" y="225" width="250" height="30" rx="4" fill="#78350f"/>
  <text x="495" y="245" text-anchor="middle" fill="#fcd34d" font-family="monospace" font-size="12">dst: 172.31.3.134:5432</text>

  <!-- Destination Changed Indicator -->
  <text x="495" y="262" text-anchor="middle" fill="#f59e0b" font-family="Inter, system-ui, sans-serif" font-size="10">↑ destination changed</text>

  <!-- Arrow 2 -->
  <line x1="350" y1="270" x2="350" y2="300" stroke="#6b7280" stroke-width="2" marker-end="url(#arrowDown)"/>
  <rect x="220" y="280" width="260" height="24" rx="4" fill="#1e293b"/>
  <text x="350" y="297" text-anchor="middle" fill="#34d399" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="500">POSTROUTING (MASQUERADE)</text>

  <!-- Final Packet Box -->
  <rect x="50" y="310" width="600" height="80" rx="8" fill="url(#packetGrad3)" filter="url(#shadow)"/>
  <text x="350" y="335" text-anchor="middle" fill="#ffffff" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="600">FINAL PACKET (leaving via eth0)</text>

  <!-- Final Packet Details -->
  <rect x="80" y="350" width="250" height="30" rx="4" fill="#064e3b"/>
  <text x="205" y="370" text-anchor="middle" fill="#6ee7b7" font-family="monospace" font-size="12">src: 172.31.18.19</text>

  <rect x="370" y="350" width="250" height="30" rx="4" fill="#064e3b"/>
  <text x="495" y="370" text-anchor="middle" fill="#6ee7b7" font-family="monospace" font-size="12">dst: 172.31.3.134:5432</text>

  <!-- Source Changed Indicator -->
  <text x="205" y="387" text-anchor="middle" fill="#10b981" font-family="Inter, system-ui, sans-serif" font-size="10">↑ source changed (EC2 IP)</text>

  <!-- Legend -->
  <rect x="50" y="410" width="600" height="30" rx="4" fill="#1e293b"/>
  <circle cx="100" cy="425" r="6" fill="#3b82f6"/>
  <text x="115" y="429" fill="#94a3b8" font-family="Inter, system-ui, sans-serif" font-size="11">WireGuard IPs</text>
  <circle cx="260" cy="425" r="6" fill="#f59e0b"/>
  <text x="275" y="429" fill="#94a3b8" font-family="Inter, system-ui, sans-serif" font-size="11">Mixed (transitioning)</text>
  <circle cx="440" cy="425" r="6" fill="#10b981"/>
  <text x="455" y="429" fill="#94a3b8" font-family="Inter, system-ui, sans-serif" font-size="11">VPC IPs (AWS internal)</text>
</svg>
