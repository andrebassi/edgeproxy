<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 380">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
    </marker>
    <marker id="arrow-return" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="380" fill="#0f172a"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" fill="#f8fafc" font-family="Inter, system-ui, sans-serif" font-size="18" font-weight="bold">Traffic Flow: Fly.io → WireGuard → EC2 NAT → RDS</text>

  <!-- Step boxes -->
  <!-- Step 1 -->
  <rect x="30" y="70" width="160" height="100" rx="10" fill="#312e81" stroke="#8b5cf6" stroke-width="2"/>
  <circle cx="50" cy="90" r="12" fill="#8b5cf6"/>
  <text x="50" y="95" text-anchor="middle" fill="white" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="bold">1</text>
  <text x="110" y="100" text-anchor="middle" fill="#c7d2fe" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="bold">App connects</text>
  <text x="110" y="120" text-anchor="middle" fill="#a5b4fc" font-family="monospace" font-size="9">DB_HOST=10.50.0.1</text>
  <text x="110" y="135" text-anchor="middle" fill="#a5b4fc" font-family="monospace" font-size="9">DB_PORT=5432</text>
  <text x="110" y="155" text-anchor="middle" fill="#818cf8" font-family="monospace" font-size="8">lib/pq PostgreSQL</text>

  <!-- Step 2 -->
  <rect x="220" y="70" width="160" height="100" rx="10" fill="#166534" stroke="#22c55e" stroke-width="2"/>
  <circle cx="240" cy="90" r="12" fill="#22c55e"/>
  <text x="240" y="95" text-anchor="middle" fill="white" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="bold">2</text>
  <text x="300" y="100" text-anchor="middle" fill="#bbf7d0" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="bold">Route via wg0</text>
  <text x="300" y="120" text-anchor="middle" fill="#86efac" font-family="monospace" font-size="9">ip route:</text>
  <text x="300" y="135" text-anchor="middle" fill="#86efac" font-family="monospace" font-size="9">10.50.0.0/24 dev wg0</text>
  <text x="300" y="155" text-anchor="middle" fill="#4ade80" font-family="monospace" font-size="8">Encrypts packet</text>

  <!-- Step 3 -->
  <rect x="410" y="70" width="160" height="100" rx="10" fill="#166534" stroke="#22c55e" stroke-width="2"/>
  <circle cx="430" cy="90" r="12" fill="#22c55e"/>
  <text x="430" y="95" text-anchor="middle" fill="white" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="bold">3</text>
  <text x="490" y="100" text-anchor="middle" fill="#bbf7d0" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="bold">UDP Tunnel</text>
  <text x="490" y="120" text-anchor="middle" fill="#86efac" font-family="monospace" font-size="9">Endpoint:</text>
  <text x="490" y="135" text-anchor="middle" fill="#86efac" font-family="monospace" font-size="9">34.240.78.199:51820</text>
  <text x="490" y="155" text-anchor="middle" fill="#4ade80" font-family="monospace" font-size="8">WireGuard UDP</text>

  <!-- Step 4 -->
  <rect x="600" y="70" width="160" height="100" rx="10" fill="#292524" stroke="#fbbf24" stroke-width="2"/>
  <circle cx="620" cy="90" r="12" fill="#fbbf24"/>
  <text x="620" y="95" text-anchor="middle" fill="#1c1917" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="bold">4</text>
  <text x="680" y="100" text-anchor="middle" fill="#fef3c7" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="bold">EC2 receives</text>
  <text x="680" y="120" text-anchor="middle" fill="#fde68a" font-family="monospace" font-size="9">wg0 interface</text>
  <text x="680" y="135" text-anchor="middle" fill="#fde68a" font-family="monospace" font-size="9">Decrypts packet</text>
  <text x="680" y="155" text-anchor="middle" fill="#fcd34d" font-family="monospace" font-size="8">src: 10.50.3.10</text>

  <!-- Step 5 -->
  <rect x="30" y="200" width="160" height="120" rx="10" fill="#7f1d1d" stroke="#ef4444" stroke-width="2"/>
  <circle cx="50" cy="220" r="12" fill="#ef4444"/>
  <text x="50" y="225" text-anchor="middle" fill="white" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="bold">5</text>
  <text x="110" y="230" text-anchor="middle" fill="#fecaca" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="bold">PREROUTING</text>
  <text x="110" y="250" text-anchor="middle" fill="#fca5a5" font-family="monospace" font-size="8">-t nat -A PREROUTING</text>
  <text x="110" y="265" text-anchor="middle" fill="#fca5a5" font-family="monospace" font-size="8">-i wg0 -p tcp</text>
  <text x="110" y="280" text-anchor="middle" fill="#fca5a5" font-family="monospace" font-size="8">--dport 5432</text>
  <text x="110" y="295" text-anchor="middle" fill="#f87171" font-family="monospace" font-size="8">-j DNAT --to RDS_IP</text>

  <!-- Step 6 -->
  <rect x="220" y="200" width="160" height="120" rx="10" fill="#7f1d1d" stroke="#ef4444" stroke-width="2"/>
  <circle cx="240" cy="220" r="12" fill="#ef4444"/>
  <text x="240" y="225" text-anchor="middle" fill="white" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="bold">6</text>
  <text x="300" y="230" text-anchor="middle" fill="#fecaca" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="bold">POSTROUTING</text>
  <text x="300" y="250" text-anchor="middle" fill="#fca5a5" font-family="monospace" font-size="8">-t nat -A POSTROUTING</text>
  <text x="300" y="265" text-anchor="middle" fill="#fca5a5" font-family="monospace" font-size="8">-d 172.31.3.134</text>
  <text x="300" y="280" text-anchor="middle" fill="#fca5a5" font-family="monospace" font-size="8">-p tcp --dport 5432</text>
  <text x="300" y="295" text-anchor="middle" fill="#f87171" font-family="monospace" font-size="8">-j MASQUERADE</text>

  <!-- Step 7 -->
  <rect x="410" y="200" width="160" height="120" rx="10" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
  <circle cx="430" cy="220" r="12" fill="#3b82f6"/>
  <text x="430" y="225" text-anchor="middle" fill="white" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="bold">7</text>
  <text x="490" y="230" text-anchor="middle" fill="#93c5fd" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="bold">RDS receives</text>
  <text x="490" y="250" text-anchor="middle" fill="#60a5fa" font-family="monospace" font-size="9">172.31.3.134:5432</text>
  <text x="490" y="270" text-anchor="middle" fill="#60a5fa" font-family="monospace" font-size="9">Sees src as EC2</text>
  <text x="490" y="290" text-anchor="middle" fill="#3b82f6" font-family="monospace" font-size="8">(172.31.18.19)</text>
  <text x="490" y="305" text-anchor="middle" fill="#60a5fa" font-family="monospace" font-size="8">Query PostgreSQL</text>

  <!-- Step 8 -->
  <rect x="600" y="200" width="160" height="120" rx="10" fill="#78350f" stroke="#f59e0b" stroke-width="2"/>
  <circle cx="620" cy="220" r="12" fill="#f59e0b"/>
  <text x="620" y="225" text-anchor="middle" fill="#1c1917" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="bold">8</text>
  <text x="680" y="230" text-anchor="middle" fill="#fef3c7" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="bold">Response returns</text>
  <text x="680" y="250" text-anchor="middle" fill="#fde68a" font-family="monospace" font-size="9">RDS → EC2</text>
  <text x="680" y="270" text-anchor="middle" fill="#fde68a" font-family="monospace" font-size="9">EC2 un-MASQ</text>
  <text x="680" y="290" text-anchor="middle" fill="#fcd34d" font-family="monospace" font-size="8">EC2 → WireGuard</text>
  <text x="680" y="305" text-anchor="middle" fill="#fcd34d" font-family="monospace" font-size="8">→ Fly.io App</text>

  <!-- Arrows between steps -->
  <path d="M 190 120 L 220 120" stroke="#22c55e" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M 380 120 L 410 120" stroke="#22c55e" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M 570 120 L 600 120" stroke="#22c55e" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M 680 170 L 680 195 L 110 195 L 110 200" stroke="#22c55e" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M 190 260 L 220 260" stroke="#22c55e" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M 380 260 L 410 260" stroke="#22c55e" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M 570 260 L 600 260" stroke="#f59e0b" stroke-width="2" fill="none" marker-end="url(#arrow-return)"/>

  <!-- Legend -->
  <rect x="780" y="335" width="100" height="35" rx="6" fill="#1e293b" stroke="#334155" stroke-width="1"/>
  <line x1="790" y1="350" x2="815" y2="350" stroke="#22c55e" stroke-width="2"/>
  <text x="825" y="354" fill="#94a3b8" font-family="Inter, system-ui, sans-serif" font-size="9">Request</text>
  <line x1="790" y1="362" x2="815" y2="362" stroke="#f59e0b" stroke-width="2"/>
  <text x="825" y="366" fill="#94a3b8" font-family="Inter, system-ui, sans-serif" font-size="9">Response</text>
</svg>
